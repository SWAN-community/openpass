<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>OpenPass Code Example</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap"
      rel="stylesheet"
      type="text/css"
    />
    <style>
      code {
        color: crimson;
        background-color: #f1f1f1;
        padding: 2px;
      }
    </style>
  </head>
  <body>
    <h1 style="text-align: center">Open Pass code examples</h1>
    <p style="text-align: center">
      <span style="text-decoration: underline"
        ><strong>Add the widget script</strong></span
      >
    </p>

    <p style="text-align: left">
      The widget script will be downloaded with all the resources and will be
      available to be instantiated on the page.
    </p>
    <code>
      &lt;script src="//openpass.criteo.com/open-pass/widget-app"
      type="text/javascript" async&gt;&lt;/script&gt;
    </code>
    <p style="text-align: center">
      <span style="text-decoration: underline"
        ><strong>Add HTML component</strong></span
      >
    </p>

    <p>
      To add the widget tag to the HTML code and the widget will be
      automatically displayed based on their configuration:
      <strong>native</strong> or <strong>modal</strong>.
    </p>
    <code>
      &lt;wdgt-identification session="authenticated" variant="dialog"
      view="modal" provider= "publisher"&gt;&lt;/wdgt-identification&gt;
    </code>
    <p style="text-align: center">
      <span style="text-decoration: underline"
        ><strong>Interacting with the widget</strong></span
      >
    </p>
    <p>
      It is possible to retrieve data available on
      <strong>OpenPass</strong> through the public API. We also provide a set of
      events that can be listened to by other scripts and trigger certain logic
      upon a change of state in the widget or user data.
    </p>
    <p>
      The user data returned by the <strong>OpenPass</strong> widget component
      will be of type <strong>UserData</strong>, defined by this model:
    </p>
    <code
      >type UserData = {<br />&nbsp; &nbsp; token: string,<br />&nbsp; &nbsp;
      isDeclined: boolean<br />}</code
    >
    <p>Properties:</p>
    <ul>
      <li>
        The token attribute is used to store the UID2 token retrieved for the
        email provided by the user.
      </li>
      <li>
        The isDeclined flag indicates whether the user has declined to join
        OpenPass. In case isDeclined = true, the token field will be empty or
        undefined and must be ignored.
      </li>
    </ul>

    <p>In practice, there are two ways of interacting with the widget:</p>
    <ul>
      <li>
        Retrieve user data calling a function provided by the widget component
      </li>
      <li>Subscribe to widget events</li>
    </ul>
    <p style="text-align: center">
      <span style="text-decoration: underline"
        ><strong>Retrieve user data</strong></span
      >
    </p>
    <p>
      The widget component provides a function called
      <strong>getUserData</strong> which can be called directly on the
      component. It will return an object of type
      <strong>UserData</strong> previously defined.
    </p>
    <p>
      Note that this function will return undefined if no user data is currently
      available on OpenPass, meaning that the user has neither joined OpenPass
      on the current site nor answered yet.
    </p>
    <code>
      const userData =
      document.querySelector('wdgt-identification').getUserData();
    </code>
    <p style="text-align: center">
      <span style="text-decoration: underline"
        ><strong>Subscribe to widget events</strong></span
      >
    </p>
    <p>Our widget emits events in two different situations:</p>
    <ul>
      <li>Widget component loaded</li>
      <li>User data updated</li>
    </ul>
    <p style="text-align: center"><strong>Widget component loaded</strong></p>
    <p>
      At this point, the component has been instantiated and it's possible to
      call its public API.
    </p>
    <ul>
      <li><strong>Event name</strong>: loaded</li>
      <li><strong>Event data</strong>: none</li>
    </ul>
    <code>
      function eventHandler(event) {<br />&nbsp; const userData =
      document.querySelector('wdgt-identification').getUserData();
      <br />
      &nbsp; // ...<br />
      }<br />
      document.querySelector('wdgt-identification').addEventListener('loaded',
      eventHandler);
    </code>
    <p style="text-align: center"><strong>User data updated</strong></p>
    <p>
      This event is triggered upon interaction from the user and will contain an
      updated version of the UserData object.
    </p>
    <ul>
      <li><strong>Event name</strong>: updated</li>
      <li><strong>Event data</strong>: a <strong>UserData</strong> object</li>
    </ul>
    <code>
      function eventHandler(event) {<br />
      &nbsp; const userData = event.data;<br />
      &nbsp; // ...<br />
      }<br />

      document.querySelector('wdgt-identification').addEventListener('updated',
      eventHandler);
    </code>
    <p style="text-align: center"><strong>Recommended strategy</strong></p>
    <p>
      The recommended strategy is to try to retrieve the current data available
      once the widget has been loaded. If it is undefined, then listen to new
      widget events in order to be notified when the user interacts with
      OpenPass.
    </p>
    <p>
      Depending on how the integration is done, the widget component may be
      loaded before calling the code that interacts with it. In that case, it
      would be better to call the <strong>getUserData</strong> function directly
      instead of waiting for the loaded event to be fired &mdash; because it was
      already missed. In case you are not sure, it is possible to do both.
    </p>
    <p>
      Some integrations will always trigger the updated event as an interaction
      from the user would be required &mdash; such as the modal view. However,
      it is not the case for all configurations.
    </p>
  </body>
</html>
